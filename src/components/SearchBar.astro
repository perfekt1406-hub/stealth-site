---
// SearchBar component with trigger logic
// Keywords: "games" -> /reference/archive, "help" -> /help
---

<div class="search-container">
  <form class="search-form" role="search" id="search-form">
    <input 
      type="search" 
      id="academic-search" 
      name="search" 
      placeholder="Search academic resources..." 
      aria-label="Search academic resources"
      class="search-input"
    />
    <button type="submit" class="search-button" aria-label="Search">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </button>
  </form>
</div>

<script>
  import { navigateTo } from '../scripts/router';

  function initSearchTrigger(): void {
    const searchInput = document.getElementById('academic-search') as HTMLInputElement;
    const searchForm = document.getElementById('search-form') as HTMLFormElement;

    if (!searchInput || !searchForm) return;

    // Case-sensitive check for keywords
    function checkSearchTrigger(value: string): void {
      const trimmedValue = value.trim().toLowerCase();
      if (trimmedValue === 'games') {
        // Navigate to /reference/archive using router
        navigateTo('/reference/archive');
        // Clear the input
        searchInput.value = '';
      } else if (trimmedValue === 'help') {
        // Navigate to /help page
        window.location.href = '/help';
        // Clear the input
        searchInput.value = '';
      }
    }

    // Listen for input changes (real-time check)
    // Only trigger on exact match to avoid navigation while typing
    searchInput.addEventListener('keyup', (e) => {
      const target = e.target as HTMLInputElement;
      const trimmedValue = target.value.trim().toLowerCase();
      // Only trigger on Enter key or when value exactly matches
      if (e.key === 'Enter' || trimmedValue === 'games' || trimmedValue === 'help') {
        checkSearchTrigger(target.value);
      }
    });

    // Prevent form submission if keywords are entered
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const value = searchInput.value.trim().toLowerCase();
      
      if (value === 'games') {
        navigateTo('/reference/archive');
        searchInput.value = '';
      } else if (value === 'help') {
        window.location.href = '/help';
        searchInput.value = '';
      }
      // For other searches, you could add normal search functionality here
    });
  }

  // Initialize when DOM is ready
  if (typeof window !== 'undefined') {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSearchTrigger);
    } else {
      initSearchTrigger();
    }
  }
</script>

<style>
  .search-container {
    margin: clamp(1rem, 2vw, 1.5rem) auto clamp(1.5rem, 3vw, 2rem);
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 100%;
    padding: 0;
    box-sizing: border-box;
  }

  .search-form {
    display: flex;
    max-width: min(600px, 90vw);
    width: 100%;
    gap: clamp(0.4rem, 1vw, 0.5rem);
    margin: 0 auto;
    box-sizing: border-box;
  }

  .search-input {
    flex: 1;
    padding: clamp(0.6rem, 1.5vw, 0.75rem) clamp(0.8rem, 2vw, 1rem);
    font-size: clamp(0.9rem, 2vw, 1rem);
    border: clamp(1px, 0.2vw, 2px) solid #e0e0e0;
    border-radius: clamp(4px, 0.5vw, 8px);
    transition: border-color 0.2s;
    margin: 0;
    box-sizing: border-box;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent, #0066cc);
  }

  .search-button {
    padding: clamp(0.75rem, 2vw, 1rem) clamp(1.25rem, 3vw, 1.5rem);
    background: var(--accent, #0066cc);
    color: white;
    border: none;
    border-radius: clamp(4px, 0.5vw, 8px);
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-sizing: border-box;
    min-height: clamp(44px, 6vw, 48px);
    min-width: clamp(44px, 6vw, 48px);
  }

  .search-button svg {
    width: clamp(18px, 2.5vw, 20px);
    height: clamp(18px, 2.5vw, 20px);
  }

  .search-button:hover {
    background: #0052a3;
    transform: scale(1.05);
  }

  .search-button:active {
    transform: scale(0.95);
  }
</style>
